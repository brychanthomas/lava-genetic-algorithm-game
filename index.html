<!DOCTYPE html>
<html>
<head>
    <script src="//cdn.jsdelivr.net/npm/phaser@3.20.0/dist/phaser.js"></script>
</head>
<body>

<script>

class Lava {
  constructor(y, game) {
    this.image1 = game.add.image(Math.floor(Math.random() * 401)-200, y, 'lava1');
    this.image1.setScale(6);
    this.image2 = game.add.image(this.image1.x+this.image1.displayWidth, y, 'lava2');
    this.image2.setScale(6);
    this.rockImage = game.add.image(Math.floor(Math.random() * 401), y, 'rock');
    this.rockImage.setScale(6);
    this.speed = 2;
    this._activated = true;
  }

  //move the lava
  update() {
    if (this._activated) {
    //move both sprites right
      this.image1.x = this.image1.x + this.speed;
      this.image2.x = this.image2.x + this.speed;
      //if one sprite is beyond visible edge, move it to the other side
      if (this.image1.x-(this.image1.displayWidth/2) > 400) {
        this.image1.x = this.image2.x-this.image1.displayWidth;
      } else if (this.image2.x-(this.image2.displayWidth/2) > 400) {
        this.image2.x = this.image1.x-this.image2.displayWidth;
      }
      //move rock
      this.rockImage.x = this.rockImage.x + this.speed;
      //if rock beyond visible edge move it to the other side
      if (this.rockImage.x - (this.rockImage.displayWidth/2) > 400) {
        this.rockImage.x = -this.rockImage.displayWidth/2
      }
    }
  }

  //check if it is safe for the player to stand on the lava
  //(whether the rock is under their x coordinate)
  checkIfSafe() {
    if (200 > this.rockImage.x-this.rockImage.displayWidth/2 && 200 < this.rockImage.x+this.rockImage.displayWidth/2) {
      return true
    }
    return false || !this._activated;
  }

  set activated(active) {
    active = Boolean(active);
    this.rockImage.visible = active;
    this.image1.visible = active;
    this.image2.visible = active;
    this._activated = active;
  }

  get activated() {
    return this.activated;
  }
}

var config = { //create configuration for game
  type: Phaser.CANVAS,
  width: 400, //size of window
  height: 600,
  pixelArt: true,
  physics: {
    default: 'arcade', //the physics engine the game will use
    arcade: {
      debug: true
    }
  },
  scene: {
    preload: preload,
    create: create,
    update: update
  }
};

//TODO: add 'activated' setters and getters to laval; when deactivated sprites are invisble and checkIfSafe always returns true
//TODO: add object/list to represent rows on the screen, each with an activated or deactivated lava in it

var game = new Phaser.Game(config); //create the game object

//initialise global variables
var player;
var lava, lava2;

function preload () { //this function loads images before the game starts
  //each image is given a name that is used to refer to it later on
  this.load.image('circle', 'assets/circle.png');
  this.load.image('lava1', 'assets/lava1.png');
  this.load.image('lava2', 'assets/lava2.png');
  this.load.image('rock', 'assets/rock.png');
}

function create () { //this function creates sprites at the start of the game
  player = this.physics.add.sprite(200, 460, 'circle'); //create the player sprite
  player.setScale(0.4); //make it appear smaller

  obstacles = this.physics.add.staticGroup(); //create group for obstacles

  this.cameras.main.setBackgroundColor('#99ff66');

  this.input.keyboard.on('keydown', moveUp);

  lava = new Lava(100, this);
  lava.activated = false;
  lava2 = new Lava(220, this);

}

function update () { //this function runs every frame
  lava.update();
  console.log(lava.checkIfSafe());
  lava2.update();
  this.cameras.main.centerOn(player.x, player.y-200);
}

function moveUp() {
  player.y = player.y-60;
}

</script>
</body>
</html>
